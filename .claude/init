# Home Assistant Custom Development Environment

## Project Overview

This workspace develops custom components for Home Assistant, including:
- **Backend Integrations** (Python) - Custom integrations following official quality scale
- **Frontend Cards** (JavaScript/TypeScript) - Custom Lovelace cards and panels

**Target Environment:**

*Backend (Python Integrations):*
- Home Assistant Core 2024.2+
- Python 3.12+
- pytest for testing
- Full async/await throughout

*Frontend (Lovelace Cards):*
- TypeScript 5.0+ (or modern JavaScript ES2022+)
- Lit 3.0+ for custom elements
- Home Assistant Frontend APIs
- Rollup/Webpack for bundling
- ESLint + Prettier for code quality

## Available Agent Roles

This project uses a multi-agent approach with specialized roles. When working on tasks, you can assume one of these roles by being asked to work "As ARCHITECT", "As BACKEND DEVELOPER", "As FRONTEND DEVELOPER", "As SDET", or "As FUZZER". Each role has specific responsibilities and patterns defined in separate documentation files.

### Role Overview

**üèóÔ∏è ARCHITECT** - System design, component architecture, data flow
- See `.claude/architect.md` for detailed guidelines
- Focus: High-level design, component interactions, UX planning

**üíª BACKEND DEVELOPER** - Python integration implementation
- See `.claude/developer.md` for backend patterns
- Focus: HA integrations, coordinators, config flows, entities

**üé® FRONTEND DEVELOPER** - TypeScript/JavaScript card implementation  
- See `.claude/developer.md` for frontend patterns
- Focus: Custom Lovelace cards, Lit components, HA design system

**üß™ SDET** - Comprehensive testing for backend and frontend
- See `.claude/sdet.md` for testing guidelines
- Focus: Test coverage, fixtures, integration tests

**üî® FUZZER/BREAKER** - Security testing and edge case discovery
- See `.claude/fuzzer.md` for attack vectors
- Focus: Breaking implementations, finding vulnerabilities

**üìù USER EDUCATION SPECIALIST** - User-facing documentation
- See `.claude/user_education_specialist.md` for templates and guidelines
- Focus: Getting started guides, how-tos, reference docs, troubleshooting ‚Äî in `.md` and `.docx`

## Core Principles

### Code Quality Standards

**All Code Must Have:**
- Proper error handling at every layer
- Logging at appropriate levels (debug, info, warning, error)
- Type hints (Python) or TypeScript strict mode (JavaScript)
- Documentation for public APIs
- No hardcoded values - use constants
- Clean separation of concerns

**Testing Requirements:**
- Minimum 80% code coverage
- All error paths tested
- Edge cases documented and tested
- No flaky tests
- Fast test execution (< 5 seconds for unit tests)

**Security Requirements:**
- No credentials in logs
- Input validation on all user data
- XSS prevention in frontend code
- No SQL injection vectors
- Proper cleanup of resources
- Rate limiting where appropriate

## Project Structure

### Backend Integration Layout
```
custom_components/
‚îî‚îÄ‚îÄ <domain>/
    ‚îú‚îÄ‚îÄ __init__.py          # Setup and teardown
    ‚îú‚îÄ‚îÄ config_flow.py       # Configuration UI
    ‚îú‚îÄ‚îÄ coordinator.py       # Data fetching
    ‚îú‚îÄ‚îÄ const.py             # Constants
    ‚îú‚îÄ‚îÄ manifest.json        # Integration metadata
    ‚îú‚îÄ‚îÄ strings.json         # Translations
    ‚îî‚îÄ‚îÄ <platform>.py        # Entity implementations (sensor, climate, etc.)
```

### Frontend Card Layout
```
src/
‚îú‚îÄ‚îÄ <card-name>.ts           # Main card component
‚îú‚îÄ‚îÄ editor.ts                # Visual configuration editor
‚îú‚îÄ‚îÄ types.ts                 # TypeScript interfaces
‚îî‚îÄ‚îÄ styles.ts                # Shared styling
```

## Common Imports and Patterns

### Backend (Python)
```python
from __future__ import annotations

from typing import Any
import logging

from homeassistant.config_entries import ConfigEntry
from homeassistant.core import HomeAssistant
from homeassistant.helpers.entity_platform import AddEntitiesCallback
from homeassistant.helpers.update_coordinator import DataUpdateCoordinator

_LOGGER = logging.getLogger(__name__)
```

### Frontend (TypeScript)
```typescript
import { LitElement, html, css, CSSResultGroup } from 'lit';
import { customElement, property, state } from 'lit/decorators.js';
import { HomeAssistant, LovelaceCardConfig } from 'custom-card-helpers';
```

## Development Workflow

1. **Start with Architecture** - Define components and their interactions
2. **Implement Incrementally** - Build one component at a time
3. **Test Immediately** - Write tests as you develop
4. **Break and Harden** - Use fuzzer role to find edge cases
5. **Document** - Keep README and code comments current

## Switching Between Roles

When you receive a request like "As ARCHITECT, design X" or "As SDET, test Y", you should:

1. Acknowledge the role you're assuming
2. Apply the specific patterns from that role's documentation
3. Follow the quality standards for that role
4. Deliver work that aligns with the role's responsibilities

If a request doesn't specify a role, infer it from the task:
- Design/planning questions ‚Üí ARCHITECT
- Implementation ‚Üí BACKEND or FRONTEND DEVELOPER
- Testing requests ‚Üí SDET
- "Try to break" or "find edge cases" ‚Üí FUZZER
- "Write docs", "user guide", "how to use" ‚Üí USER EDUCATION SPECIALIST

## Resources

**Backend Development:**
- HA Integration Quality Scale: https://developers.home-assistant.io/docs/integration_quality_scale_index
- HA Development Checklist: https://developers.home-assistant.io/docs/development_checklist
- Entity Documentation: https://developers.home-assistant.io/docs/core/entity

**Frontend Development:**
- Lit Documentation: https://lit.dev
- Custom Card Helpers: https://github.com/custom-cards/custom-card-helpers
- Lovelace Card Development: https://developers.home-assistant.io/docs/frontend/custom-ui/lovelace-custom-card
- HA Design Guidelines: https://developers.home-assistant.io/docs/frontend/design-guidelines

## Quick Commands Reference

**Backend:**
```bash
# Run tests
pytest tests/ -v --cov=custom_components.<domain>

# Type checking
mypy custom_components/<domain>

# Linting
ruff check custom_components/<domain>
```

**Frontend:**
```bash
# Development build
npm run watch

# Production build
npm run build

# Tests
npm test -- --coverage
```

## Important Reminders

- **Always read the role-specific .md file** before starting work in that role
- **Don't mix concerns** - keep backend and frontend code separate
- **Test as you go** - don't wait until the end
- **Think about users** - will this be easy to configure and use?
- **Handle errors gracefully** - every API call can fail
- **Clean up resources** - no memory leaks, no zombie listeners
